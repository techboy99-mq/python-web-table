<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MQ Install Charts</title>
  <link rel="stylesheet" href="css/jquery.dataTables.min.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
    }
    canvas {
      max-width: 600px;
      margin: 2rem auto;
      display: block;
    }
    a {
      display: inline-block;
      margin-bottom: 2rem;
      text-decoration: none;
      color: #0077cc;
    }
  </style>
</head>
<body>
  <a href="index.html">‚Üê Back to Table</a>
  <h2>MQ Install Summary Charts</h2>

  <canvas id="overallStatusChart"></canvas>
  <canvas id="statusByTypeChart"></canvas>

  <script src="js/chart.4.4.1.umd.min.js"></script>
  <script src="js/papaparse.min.js"></script>
  <script>
    function loadCSVData(callback) {
      Papa.parse('data.csv?t=' + Date.now(), {
        download: true,
        header: false,
        skipEmptyLines: true,
        complete: results => {
          callback(results.data);
        }
      });
    }

    function drawCharts(data) {
      const statusCounts = { success: 0, failed: 0 };
      const installTypeStatus = {
        client: { success: 0, failed: 0 },
        server: { success: 0, failed: 0 }
      };

      data.forEach(row => {
        const type = row[2].toLowerCase();
        const status = row[5].toLowerCase();

        if (status === "success" || status === "failed") {
          statusCounts[status] += 1;

          if (installTypeStatus[type]) {
            installTypeStatus[type][status] += 1;
          }
        }
      });

      // Chart 1: Overall Success/Failed
      new Chart(document.getElementById('overallStatusChart'), {
        type: 'pie',
        data: {
          labels: ['Success', 'Failed'],
          datasets: [{
            data: [statusCounts.success, statusCounts.failed],
            backgroundColor: ['#4caf50', '#f44336']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Overall Install Status'
            }
          }
        }
      });

      // Chart 2: Success/Failed by Install Type
      new Chart(document.getElementById('statusByTypeChart'), {
        type: 'pie',
        data: {
          labels: [
            'Client Success', 'Client Failed',
            'Server Success', 'Server Failed'
          ],
          datasets: [{
            data: [
              installTypeStatus.client.success,
              installTypeStatus.client.failed,
              installTypeStatus.server.success,
              installTypeStatus.server.failed
            ],
            backgroundColor: ['#4caf50', '#f44336', '#2196f3', '#ff9800']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Install Status by Type (Client / Server)'
            }
          }
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadCSVData(drawCharts);
    });
  </script>
</body>
</html>
